{"version":3,"file":"p5.drawer.es5.js","sources":["../src/p5.drawer.ts"],"sourcesContent":["//how detect loadSound on prototype or @types\nimport { default as p5, Image, SoundFile, Vector } from 'p5'\nimport 'p5/global'\nimport 'p5/lib/addons/p5.sound'\nimport 'p5/lib/addons/p5.dom'\n\n/// <reference path=\"../node_modules/p5/lib/addons/p5.sound.js\" />\n\ninterface IAssets {\n  [key: string]: {\n    image: Image\n    imageFile: string\n    sound: SoundFile\n    soundFile: string\n  }\n}\nlet _loadedAssets: IAssets = {\n  drawer: {\n    image: new p5.Image(),\n    sound: new p5.SoundFile(''),\n    imageFile:\n      'https://raw.githack.com/doriclaudino/p5.drawer/master/assets/images/pencildrawer.png',\n    soundFile:\n      'https://raw.githubusercontent.com/doriclaudino/p5.drawer/master/assets/sounds/pencildrawer.mp3'\n  },\n  axidrawer: {\n    image: new p5.Image(),\n    sound: new p5.SoundFile(''),\n    imageFile: 'https://raw.githack.com/doriclaudino/p5.drawer/master/assets/images/axidrawer.png',\n    soundFile:\n      'https://raw.githubusercontent.com/doriclaudino/p5.drawer/master/assets/sounds/axidrawer.mp3'\n  },\n  scribitdrawer: {\n    image: new p5.Image(),\n    sound: new p5.SoundFile(''),\n    imageFile:\n      'https://raw.githack.com/doriclaudino/p5.drawer/master/assets/images/scribitdrawer.png',\n    soundFile:\n      'https://raw.githubusercontent.com/doriclaudino/p5.drawer/master/assets/sounds/axidrawer.mp3'\n  }\n}\n\n//@ts-ignore\np5.prototype.initDrawer = function() {\n  Object.keys(_loadedAssets).forEach(drawerName => {\n    let drawerData = _loadedAssets[drawerName]\n    //@ts-ignore\n    drawerData.sound = this.loadSound(drawerData.soundFile)\n    drawerData.image = this.loadImage(drawerData.imageFile)\n    _loadedAssets[drawerName] = drawerData\n  })\n}\n//@ts-ignore\np5.prototype.registerMethod('init', p5.prototype.initDrawer)\n\nexport class Drawer {\n  _sketch: p5\n  _speed: number\n  _image: Image\n  _sound: SoundFile\n  _position: Vector\n  _targetPosition: Vector\n  _saveSteps: boolean\n  _penTipPosition: Vector\n  _steps: Vector[]\n\n  constructor(p?: p5) {\n    //@ts-ignore\n    this._sketch = p || window\n    let indexName = this.constructor.name.toLowerCase()\n    if (!this.sketch) throw 'p5 not defined'\n    this._speed = 2\n    this._image = _loadedAssets[indexName].image\n    this._sound = _loadedAssets[indexName].sound\n    this._position = this._sketch.createVector(0, 0)\n    this._targetPosition = this._sketch.createVector(0, 0)\n    this._saveSteps = true\n    this._penTipPosition = this._sketch.createVector(-52, -128)\n    this._steps = []\n    console.log(this)\n  }\n\n  get sketch() {\n    return this._sketch\n  }\n\n  set sketch(sketch) {\n    this._sketch = sketch\n  }\n\n  get speed() {\n    return this._speed\n  }\n\n  set speed(speed) {\n    this._speed = speed\n  }\n\n  get sound() {\n    return this._sound\n  }\n\n  set sound(sound) {\n    this._sound = sound\n  }\n\n  get image() {\n    return this._image\n  }\n\n  set image(image) {\n    this._image = image\n  }\n\n  get steps() {\n    return this._steps\n  }\n\n  set steps(steps) {\n    this._steps = steps\n  }\n\n  get position() {\n    return this._position\n  }\n\n  set position(position) {\n    this._position = position\n  }\n\n  get targetPosition() {\n    return this._targetPosition\n  }\n\n  set targetPosition(targetPosition) {\n    this._targetPosition = targetPosition\n  }\n\n  get saveSteps() {\n    return this._saveSteps\n  }\n\n  set saveSteps(canSaveSteps) {\n    this._saveSteps = canSaveSteps\n  }\n\n  get penTipPosition() {\n    return this._penTipPosition\n  }\n\n  set penTipPosition(penTipPosition) {\n    this._penTipPosition = penTipPosition\n  }\n\n  stopSound() {\n    this.sound.stop()\n  }\n\n  /**\n   * check if still need to move\n   */\n  get hasToMove() {\n    return this.targetPosition && this.position && this.targetDistance > 0\n  }\n\n  get targetReached() {\n    return !this.hasToMove\n  }\n\n  /**\n   * 2d distance\n   */\n  get targetDistance() {\n    return this.sketch.dist(\n      this.targetPosition.x,\n      this.targetPosition.y,\n      this.position.x,\n      this.position.y\n    )\n  }\n\n  /**\n   * create a loop\n   * to-do: play with loop speed, based on speed or penstyle\n   */\n  playAudio(replaceSpeed: number) {\n    if (this.hasToMove) {\n      if (!this.sound.isPlaying()) {\n        this.sound.play()\n      }\n    } else this.sound.stop()\n    this.applySoundSpeed(replaceSpeed)\n  }\n\n  applySoundSpeed(replaceSpeed: number) {\n    let currentSpeed = replaceSpeed ? replaceSpeed : this.speed\n    //todo create a map for control the soundspeed, ex: from 1 to 100  map to 0.5 to 4\n    let soundSpeed = this.sketch.map(currentSpeed, 1, 100, 0.5, 4)\n    soundSpeed = this.sketch.constrain(soundSpeed, 0.01, 4)\n    this.sound.rate(soundSpeed)\n  }\n\n  /**\n   * @param coordinate vector where you want to move\n   * @param replaceSpeed override the speed for next movements until reach the target\n   */\n  moveTo(coordinate: Vector, replaceSpeed: number) {\n    this.targetPosition = coordinate\n    this.startMovement(replaceSpeed)\n  }\n\n  /**\n   *\n   * @param replaceSpeed override the speed for next movements until reach the target\n   */\n  startMovement(replaceSpeed: number) {\n    if (this.hasToMove) this.updateToNextPosition(replaceSpeed)\n    this.draw()\n    this.playAudio(replaceSpeed)\n  }\n\n  draw() {\n    this.sketch.push()\n    this.sketch.translate(this.penTipPosition)\n\n    //draw an image as last element to override everythin an maitain the shadow effect\n    this.sketch.image(this.image, this.position.x, this.position.y)\n    this.sketch.pop()\n  }\n\n  /**\n   *\n   * @param replaceSpeed override the speed for next movements until reach the target\n   */\n  updateToNextPosition(replaceSpeed: number) {\n    //show image as last element\n    let nextY, nextX, distanceFromX, distanceFromY, minimalDistanceFromX, minimalDistanceFromY\n\n    //check if user override the main speed\n    let definedSpeed = replaceSpeed ? replaceSpeed : this.speed\n\n    //absolute distance (ignore minus)\n    distanceFromX = Math.abs(this.targetPosition.x - this.position.x)\n    distanceFromY = Math.abs(this.targetPosition.y - this.position.y)\n\n    //max step available based on distance and speed/pixels\n    minimalDistanceFromX = Math.min(definedSpeed, distanceFromX)\n    minimalDistanceFromY = Math.min(definedSpeed, distanceFromY)\n\n    //increase or decrease X-axe\n    if (this.position.x > this.targetPosition.x)\n      //decrease\n      nextX = this.position.x - minimalDistanceFromX\n    //increase\n    else nextX = this.position.x + minimalDistanceFromX\n\n    //increase or decrease Y-axe\n    if (this.position.y > this.targetPosition.y)\n      //decrease\n      nextY = this.position.y - minimalDistanceFromY\n    //increase\n    else nextY = this.position.y + minimalDistanceFromY\n\n    //create next position\n    let nextPositionVector = this.sketch.createVector(nextX, nextY)\n\n    //save the step\n    if (this.saveSteps) this.steps.push(nextPositionVector)\n\n    //update the current position\n    this.position = nextPositionVector\n  }\n}\n\nexport class AxiDrawer extends Drawer {\n  constructor(p?: p5) {\n    super(p)\n    this.speed = this.speed * 2\n    this.penTipPosition = this.sketch.createVector(-100, -52)\n  }\n}\n\nexport class ScribitDrawer extends Drawer {\n  constructor(p?: p5) {\n    super(p)\n    this.speed = this.speed * 2\n    this.penTipPosition = this.sketch.createVector(-140, -108)\n  }\n}\n"],"names":[],"mappings":"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"}