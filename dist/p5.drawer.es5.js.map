{"version":3,"file":"p5.drawer.es5.js","sources":["../src/p5.drawer.ts"],"sourcesContent":["//how detect loadSound on prototype or @types\r\nimport { default as p5, Image, SoundFile, Vector } from 'p5'\r\nimport 'p5/global'\r\nimport 'p5/lib/addons/p5.sound'\r\nimport 'p5/lib/addons/p5.dom'\r\n\r\n/// <reference path=\"../node_modules/p5/lib/addons/p5.sound.js\" />\r\n\r\ninterface IAssets {\r\n  [key: string]: {\r\n    image: Image\r\n    imageFile: string\r\n    sound: SoundFile\r\n    soundFile: string\r\n  }\r\n}\r\nlet _loadedAssets: IAssets = {\r\n  drawer: {\r\n    image: new Image(),\r\n    sound: new SoundFile(''),\r\n    imageFile: '../assets/images/pencildrawer.png',\r\n    soundFile: '../assets/sounds/pencildrawer.mp3'\r\n  },\r\n  axidrawer: {\r\n    image: new Image(),\r\n    sound: new SoundFile(''),\r\n    imageFile: '../assets/images/axidrawer.png',\r\n    soundFile: '../assets/sounds/axidrawer.mp3'\r\n  },\r\n  scribitdrawer: {\r\n    image: new Image(),\r\n    sound: new SoundFile(''),\r\n    imageFile: '../assets/images/scribitdrawer.png',\r\n    soundFile: '../assets/sounds/axidrawer.mp3'\r\n  }\r\n}\r\n\r\n//@ts-ignore\r\np5.prototype.initDrawer = function() {\r\n  Object.keys(_loadedAssets).forEach(drawerName => {\r\n    let drawerData = _loadedAssets[drawerName]\r\n    //@ts-ignore\r\n    drawerData.sound = this.loadSound(drawerData.soundFile)\r\n    drawerData.image = this.loadImage(drawerData.imageFile)\r\n    _loadedAssets[drawerName] = drawerData\r\n  })\r\n}\r\n//@ts-ignore\r\np5.prototype.registerMethod('init', p5.prototype.initDrawer)\r\n\r\nexport class Drawer {\r\n  _sketch: p5\r\n  _speed: number\r\n  _image: Image\r\n  _sound: SoundFile\r\n  _position: Vector\r\n  _targetPosition: Vector\r\n  _saveSteps: boolean\r\n  _penTipPosition: Vector\r\n  _steps: Vector[]\r\n\r\n  constructor(p: p5) {\r\n    //@ts-ignore\r\n    this._sketch = p || window\r\n    let indexName = this.constructor.name.toLowerCase()\r\n    if (!this.sketch) throw 'p5 not defined'\r\n    this._speed = 2\r\n    this._image = _loadedAssets[indexName].image\r\n    this._sound = _loadedAssets[indexName].sound\r\n    this._position = this._sketch.createVector(0, 0)\r\n    this._targetPosition = this._sketch.createVector(0, 0)\r\n    this._saveSteps = true\r\n    this._penTipPosition = this._sketch.createVector(-52, -128)\r\n    this._steps = []\r\n    console.log(this)\r\n  }\r\n\r\n  get sketch() {\r\n    return this._sketch\r\n  }\r\n\r\n  set sketch(sketch) {\r\n    this._sketch = sketch\r\n  }\r\n\r\n  get speed() {\r\n    return this._speed\r\n  }\r\n\r\n  set speed(speed) {\r\n    this._speed = speed\r\n  }\r\n\r\n  get sound() {\r\n    return this._sound\r\n  }\r\n\r\n  set sound(sound) {\r\n    this._sound = sound\r\n  }\r\n\r\n  get image() {\r\n    return this._image\r\n  }\r\n\r\n  set image(image) {\r\n    this._image = image\r\n  }\r\n\r\n  get steps() {\r\n    return this._steps\r\n  }\r\n\r\n  set steps(steps) {\r\n    this._steps = steps\r\n  }\r\n\r\n  get position() {\r\n    return this._position\r\n  }\r\n\r\n  set position(position) {\r\n    this._position = position\r\n  }\r\n\r\n  get targetPosition() {\r\n    return this._targetPosition\r\n  }\r\n\r\n  set targetPosition(targetPosition) {\r\n    this._targetPosition = targetPosition\r\n  }\r\n\r\n  get saveSteps() {\r\n    return this._saveSteps\r\n  }\r\n\r\n  set saveSteps(canSaveSteps) {\r\n    this._saveSteps = canSaveSteps\r\n  }\r\n\r\n  get penTipPosition() {\r\n    return this._penTipPosition\r\n  }\r\n\r\n  set penTipPosition(penTipPosition) {\r\n    this._penTipPosition = penTipPosition\r\n  }\r\n\r\n  stopSound() {\r\n    this.sound.stop()\r\n  }\r\n\r\n  /**\r\n   * check if still need to move\r\n   */\r\n  get hasToMove() {\r\n    return this.targetPosition && this.position && this.targetDistance > 0\r\n  }\r\n\r\n  get targetReached() {\r\n    return !this.hasToMove\r\n  }\r\n\r\n  /**\r\n   * 2d distance\r\n   */\r\n  get targetDistance() {\r\n    return this.sketch.dist(\r\n      this.targetPosition.x,\r\n      this.targetPosition.y,\r\n      this.position.x,\r\n      this.position.y\r\n    )\r\n  }\r\n\r\n  /**\r\n   * create a loop\r\n   * to-do: play with loop speed, based on speed or penstyle\r\n   */\r\n  playAudio(replaceSpeed: number) {\r\n    if (this.hasToMove) {\r\n      if (!this.sound.isPlaying()) {\r\n        this.sound.play()\r\n      }\r\n    } else this.sound.stop()\r\n    this.applySoundSpeed(replaceSpeed)\r\n  }\r\n\r\n  applySoundSpeed(replaceSpeed: number) {\r\n    let currentSpeed = replaceSpeed ? replaceSpeed : this.speed\r\n    //todo create a map for control the soundspeed, ex: from 1 to 100  map to 0.5 to 4\r\n    let soundSpeed = this.sketch.map(currentSpeed, 1, 100, 0.5, 4)\r\n    soundSpeed = this.sketch.constrain(soundSpeed, 0.01, 4)\r\n    this.sound.rate(soundSpeed)\r\n  }\r\n\r\n  /**\r\n   * @param coordinate vector where you want to move\r\n   * @param replaceSpeed override the speed for next movements until reach the target\r\n   */\r\n  moveTo(coordinate: Vector, replaceSpeed: number) {\r\n    this.targetPosition = coordinate\r\n    this.startMovement(replaceSpeed)\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param replaceSpeed override the speed for next movements until reach the target\r\n   */\r\n  startMovement(replaceSpeed: number) {\r\n    if (this.hasToMove) this.updateToNextPosition(replaceSpeed)\r\n    this.draw()\r\n    this.playAudio(replaceSpeed)\r\n  }\r\n\r\n  draw() {\r\n    this.sketch.push()\r\n    this.sketch.translate(this.penTipPosition)\r\n\r\n    //draw an image as last element to override everythin an maitain the shadow effect\r\n    this.sketch.image(this.image, this.position.x, this.position.y)\r\n    this.sketch.pop()\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param replaceSpeed override the speed for next movements until reach the target\r\n   */\r\n  updateToNextPosition(replaceSpeed: number) {\r\n    //show image as last element\r\n    let nextY, nextX, distanceFromX, distanceFromY, minimalDistanceFromX, minimalDistanceFromY\r\n\r\n    //check if user override the main speed\r\n    let definedSpeed = replaceSpeed ? replaceSpeed : this.speed\r\n\r\n    //absolute distance (ignore minus)\r\n    distanceFromX = Math.abs(this.targetPosition.x - this.position.x)\r\n    distanceFromY = Math.abs(this.targetPosition.y - this.position.y)\r\n\r\n    //max step available based on distance and speed/pixels\r\n    minimalDistanceFromX = Math.min(definedSpeed, distanceFromX)\r\n    minimalDistanceFromY = Math.min(definedSpeed, distanceFromY)\r\n\r\n    //increase or decrease X-axe\r\n    if (this.position.x > this.targetPosition.x)\r\n      //decrease\r\n      nextX = this.position.x - minimalDistanceFromX\r\n    //increase\r\n    else nextX = this.position.x + minimalDistanceFromX\r\n\r\n    //increase or decrease Y-axe\r\n    if (this.position.y > this.targetPosition.y)\r\n      //decrease\r\n      nextY = this.position.y - minimalDistanceFromY\r\n    //increase\r\n    else nextY = this.position.y + minimalDistanceFromY\r\n\r\n    //create next position\r\n    let nextPositionVector = this.sketch.createVector(nextX, nextY)\r\n\r\n    //save the step\r\n    if (this.saveSteps) this.steps.push(nextPositionVector)\r\n\r\n    //update the current position\r\n    this.position = nextPositionVector\r\n  }\r\n}\r\n\r\nexport class AxiDrawer extends Drawer {\r\n  constructor(p: p5) {\r\n    super(p)\r\n    this.speed = this.speed * 2\r\n    this.penTipPosition = this.sketch.createVector(-100, -52)\r\n  }\r\n}\r\n\r\nexport class ScribitDrawer extends Drawer {\r\n  constructor(p: p5) {\r\n    super(p)\r\n    this.speed = this.speed * 2\r\n    this.penTipPosition = this.sketch.createVector(-140, -108)\r\n  }\r\n}\r\n"],"names":["Image","SoundFile","p5"],"mappings":"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"}