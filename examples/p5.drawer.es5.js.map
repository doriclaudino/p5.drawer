{"version":3,"file":"p5.drawer.es5.js","sources":["../src/p5.drawer.ts"],"sourcesContent":["//how detect loadSound on prototype or @types\r\nimport { default as p5, Image, SoundFile, Vector } from 'p5'\r\nimport 'p5/global'\r\nimport 'p5/lib/addons/p5.sound'\r\nimport 'p5/lib/addons/p5.dom'\r\n\r\n/// <reference path=\"../node_modules/p5/lib/addons/p5.sound.js\" />\r\n\r\ninterface IAssetInitInput {\r\n  [key: string]: {\r\n    image?: Image | string\r\n    sound?: SoundFile | string\r\n  }\r\n}\r\n\r\ninterface IAssetBaseProps {\r\n  image?: Image\r\n  sound?: SoundFile\r\n}\r\n\r\ninterface IAssetsProps extends IAssetBaseProps {\r\n  imageFile: string\r\n  soundFile: string\r\n}\r\ninterface IAssets {\r\n  [key: string]: IAssetsProps\r\n}\r\n\r\nlet _loadedAssets: IAssets = {\r\n  drawer: {\r\n    image: new p5.Image(),\r\n    imageFile:\r\n      'https://raw.githack.com/doriclaudino/p5.drawer/master/assets/images/pencildrawer.png',\r\n    soundFile:\r\n      'https://raw.githubusercontent.com/doriclaudino/p5.drawer/master/assets/sounds/pencildrawer.mp3'\r\n  },\r\n  axidrawer: {\r\n    image: new p5.Image(),\r\n    imageFile: 'https://raw.githack.com/doriclaudino/p5.drawer/master/assets/images/axidrawer.png',\r\n    soundFile:\r\n      'https://raw.githubusercontent.com/doriclaudino/p5.drawer/master/assets/sounds/axidrawer.mp3'\r\n  },\r\n  scribitdrawer: {\r\n    image: new p5.Image(),\r\n    imageFile:\r\n      'https://raw.githack.com/doriclaudino/p5.drawer/master/assets/images/scribitdrawer.png',\r\n    soundFile:\r\n      'https://raw.githubusercontent.com/doriclaudino/p5.drawer/master/assets/sounds/axidrawer.mp3'\r\n  }\r\n}\r\n\r\n/**\r\n * load drawers assets\r\n * user can override it calling this method on preload()\r\n */\r\n//@ts-ignore\r\np5.prototype.initDrawer = function(resolveAssets: IAssetInitInput) {\r\n  let drawerNames = Object.keys(_loadedAssets)\r\n  drawerNames.forEach((drawerName: keyof IAssets) => {\r\n    let assetProps = _loadedAssets && _loadedAssets[drawerName]\r\n    let resolveProps = resolveAssets && resolveAssets[drawerName]\r\n\r\n    var callbackImg = (img: Image) => (_loadedAssets[drawerName].image = img)\r\n    var callbackSound = (sound: SoundFile) => (_loadedAssets[drawerName].sound = sound)\r\n\r\n    /**\r\n     * image\r\n     */\r\n    if (resolveProps && resolveProps.image) {\r\n      /**\r\n       * load the user url/path or defaultUrl\r\n       */\r\n      if (typeof resolveProps.image === 'string')\r\n        this.loadImage(resolveProps.image, callbackImg, (e: Event) =>\r\n          this.loadImage(assetProps.imageFile, callbackImg)\r\n        )\r\n      else {\r\n        //user pass an image already loaded\r\n        callbackImg(resolveProps.image as Image)\r\n      }\r\n    } else {\r\n      //try to load default url\r\n      this.loadImage(assetProps.imageFile, callbackImg)\r\n    }\r\n\r\n    /**\r\n     * sound\r\n     */\r\n    if (resolveProps && resolveProps.sound) {\r\n      //load the user url/path or defaultUrl\r\n      if (typeof resolveProps.sound === 'string')\r\n        //@ts-ignore\r\n        this.loadSound(resolveProps.sound, callbackImg, (e: Event) =>\r\n          //@ts-ignore\r\n          this.loadSound(assetProps.soundFile, callbackImg)\r\n        )\r\n      else {\r\n        //user pass an sound already loaded\r\n        callbackSound(resolveProps.sound as SoundFile)\r\n      }\r\n    } else {\r\n      //try to load default url\r\n      //@ts-ignore\r\n      this.loadSound(assetProps.soundFile, callbackSound)\r\n    }\r\n  })\r\n}\r\n//@ts-ignore\r\np5.prototype.registerMethod('init', p5.prototype.initDrawer)\r\n\r\nexport class Drawer {\r\n  _sketch: p5\r\n  _speed: number\r\n  _image?: Image\r\n  _sound?: SoundFile\r\n  _position: Vector\r\n  _targetPosition: Vector\r\n  _saveSteps: boolean\r\n  _penTipPosition: Vector\r\n  _steps: Vector[]\r\n\r\n  constructor(p?: p5) {\r\n    //@ts-ignore\r\n    this._sketch = p || window\r\n    if (!this.sketch) throw 'p5 not defined'\r\n    this._speed = 2\r\n    this._image = _loadedAssets['drawer'].image\r\n    this._sound = _loadedAssets['drawer'].sound\r\n    this._position = this._sketch.createVector(0, 0)\r\n    this._targetPosition = this._sketch.createVector(0, 0)\r\n    this._saveSteps = true\r\n    this._penTipPosition = this._sketch.createVector(-52, -128)\r\n    this._steps = []\r\n    if (!this.image || !this.sound)\r\n      console.warn(\r\n        `Make sure to load the image and sound on preload(), we remove the boths from build. See the example folder.`\r\n      )\r\n  }\r\n\r\n  get sketch() {\r\n    return this._sketch\r\n  }\r\n\r\n  set sketch(sketch) {\r\n    this._sketch = sketch\r\n  }\r\n\r\n  get speed() {\r\n    return this._speed\r\n  }\r\n\r\n  set speed(speed) {\r\n    this._speed = speed\r\n  }\r\n\r\n  get sound() {\r\n    return this._sound\r\n  }\r\n\r\n  set sound(sound) {\r\n    this._sound = sound\r\n  }\r\n\r\n  get image() {\r\n    return this._image\r\n  }\r\n\r\n  set image(image) {\r\n    this._image = image\r\n  }\r\n\r\n  get steps() {\r\n    return this._steps\r\n  }\r\n\r\n  set steps(steps) {\r\n    this._steps = steps\r\n  }\r\n\r\n  get position() {\r\n    return this._position\r\n  }\r\n\r\n  set position(position) {\r\n    this._position = position\r\n  }\r\n\r\n  get targetPosition() {\r\n    return this._targetPosition\r\n  }\r\n\r\n  set targetPosition(targetPosition) {\r\n    this._targetPosition = targetPosition\r\n  }\r\n\r\n  get saveSteps() {\r\n    return this._saveSteps\r\n  }\r\n\r\n  set saveSteps(canSaveSteps) {\r\n    this._saveSteps = canSaveSteps\r\n  }\r\n\r\n  get penTipPosition() {\r\n    return this._penTipPosition\r\n  }\r\n\r\n  set penTipPosition(penTipPosition) {\r\n    this._penTipPosition = penTipPosition\r\n  }\r\n\r\n  stopSound() {\r\n    this.sound && this.sound.stop()\r\n  }\r\n\r\n  /**\r\n   * check if still need to move\r\n   */\r\n  get hasToMove() {\r\n    return this.targetPosition && this.position && this.targetDistance > 0\r\n  }\r\n\r\n  get targetReached() {\r\n    return !this.hasToMove\r\n  }\r\n\r\n  /**\r\n   * 2d distance\r\n   */\r\n  get targetDistance() {\r\n    return this.sketch.dist(\r\n      this.targetPosition.x,\r\n      this.targetPosition.y,\r\n      this.position.x,\r\n      this.position.y\r\n    )\r\n  }\r\n\r\n  /**\r\n   * create a loop\r\n   * to-do: play with loop speed, based on speed or penstyle\r\n   */\r\n  playAudio(replaceSpeed: number) {\r\n    if (this.hasToMove) {\r\n      if (this.sound && !this.sound.isPlaying()) {\r\n        this.sound.play()\r\n      }\r\n    } else this.sound && this.sound.stop()\r\n    this.applySoundSpeed(replaceSpeed)\r\n  }\r\n\r\n  applySoundSpeed(replaceSpeed: number) {\r\n    let currentSpeed = replaceSpeed ? replaceSpeed : this.speed\r\n    //todo create a map for control the soundspeed, ex: from 1 to 100  map to 0.5 to 4\r\n    let soundSpeed = this.sketch.map(currentSpeed, 1, 100, 0.5, 4)\r\n    soundSpeed = this.sketch.constrain(soundSpeed, 0.01, 4)\r\n    this.sound && this.sound.rate(soundSpeed)\r\n  }\r\n\r\n  /**\r\n   * @param coordinate vector where you want to move\r\n   * @param replaceSpeed override the speed for next movements until reach the target\r\n   */\r\n  moveTo(coordinate: Vector, replaceSpeed: number) {\r\n    this.targetPosition = coordinate\r\n    this.startMovement(replaceSpeed)\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param replaceSpeed override the speed for next movements until reach the target\r\n   */\r\n  startMovement(replaceSpeed: number) {\r\n    if (this.hasToMove) this.updateToNextPosition(replaceSpeed)\r\n    this.draw()\r\n    this.playAudio(replaceSpeed)\r\n  }\r\n\r\n  draw() {\r\n    this.sketch.push()\r\n    this.sketch.translate(this.penTipPosition)\r\n\r\n    //draw an image as last element to override everythin an maitain the shadow effect\r\n    if (this.image) this.sketch.image(this.image, this.position.x, this.position.y)\r\n    this.sketch.pop()\r\n  }\r\n\r\n  /**\r\n   *\r\n   * @param replaceSpeed override the speed for next movements until reach the target\r\n   */\r\n  updateToNextPosition(replaceSpeed: number) {\r\n    //show image as last element\r\n    let nextY, nextX, distanceFromX, distanceFromY, minimalDistanceFromX, minimalDistanceFromY\r\n\r\n    //check if user override the main speed\r\n    let definedSpeed = replaceSpeed ? replaceSpeed : this.speed\r\n\r\n    //absolute distance (ignore minus)\r\n    distanceFromX = Math.abs(this.targetPosition.x - this.position.x)\r\n    distanceFromY = Math.abs(this.targetPosition.y - this.position.y)\r\n\r\n    //max step available based on distance and speed/pixels\r\n    minimalDistanceFromX = Math.min(definedSpeed, distanceFromX)\r\n    minimalDistanceFromY = Math.min(definedSpeed, distanceFromY)\r\n\r\n    //increase or decrease X-axe\r\n    if (this.position.x > this.targetPosition.x)\r\n      //decrease\r\n      nextX = this.position.x - minimalDistanceFromX\r\n    //increase\r\n    else nextX = this.position.x + minimalDistanceFromX\r\n\r\n    //increase or decrease Y-axe\r\n    if (this.position.y > this.targetPosition.y)\r\n      //decrease\r\n      nextY = this.position.y - minimalDistanceFromY\r\n    //increase\r\n    else nextY = this.position.y + minimalDistanceFromY\r\n\r\n    //create next position\r\n    let nextPositionVector = this.sketch.createVector(nextX, nextY)\r\n\r\n    //save the step\r\n    if (this.saveSteps) this.steps.push(nextPositionVector)\r\n\r\n    //update the current position\r\n    this.position = nextPositionVector\r\n  }\r\n}\r\n\r\nexport class AxiDrawer extends Drawer {\r\n  constructor(p?: p5) {\r\n    super(p)\r\n    this._image = _loadedAssets['axidrawer'].image\r\n    this._sound = _loadedAssets['axidrawer'].sound\r\n    this.speed = this.speed * 2\r\n    this.penTipPosition = this.sketch.createVector(-100, -52)\r\n  }\r\n}\r\n\r\nexport class ScribitDrawer extends Drawer {\r\n  constructor(p?: p5) {\r\n    super(p)\r\n    this._image = _loadedAssets['scribitdrawer'].image\r\n    this._sound = _loadedAssets['scribitdrawer'].sound\r\n    this.speed = this.speed * 2\r\n    this.penTipPosition = this.sketch.createVector(-140, -108)\r\n  }\r\n}\r\n"],"names":["_loadedAssets","drawer","image","p5","Image","imageFile","soundFile","axidrawer","scribitdrawer","prototype","initDrawer","resolveAssets","Object","keys","forEach","drawerName","callbackImg","img","callbackSound","sound","assetProps","resolveProps","_this","loadImage","e","loadSound","registerMethod","Drawer","this","_sketch","sketch","_speed","speed","_sound","_image","_steps","steps","_position","position","_targetPosition","targetPosition","_saveSteps","canSaveSteps","_penTipPosition","penTipPosition","stop","targetDistance","hasToMove","dist","x","y","replaceSpeed","isPlaying","play","applySoundSpeed","currentSpeed","soundSpeed","map","constrain","rate","coordinate","startMovement","updateToNextPosition","draw","playAudio","push","translate","pop","nextY","nextX","distanceFromX","distanceFromY","minimalDistanceFromX","minimalDistanceFromY","definedSpeed","Math","abs","min","nextPositionVector","createVector","saveSteps","p","window","console","warn","__extends","_super"],"mappings":"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"}